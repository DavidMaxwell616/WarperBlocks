<!DOCTYPE html>
<html>
  <head>
    <script src="js/phaser.3.18.1.min.js" crossorigin="anonymous"></script>
  </head>

  <body>
    <script>
      var config = {
        width: 300,
        height: 300,
        type: Phaser.AUTO,
        backgroundColor: '#111111',
        parent: 'phaser-example',
        scene: {
          preload: preload,
          create: create,
          update: update,
        },
      };
      var blocks = [];

      var game = new Phaser.Game(config);

      function preload() {
        this.load.path = './assets/images/';
        for (let x = 0; x <= 2; x++) {
          for (let y = 0; y <= 2; y++) {
            this.load.image('block' + x + y, 'block' + x + y + '.png');
          }
        }
      }

      function create() {
        var width = this.game.config.width;
        var height = this.game.config.height;
        for (let y = 0; y <= 2; y++) {
          blocks[y] = [];
          for (let x = 0; x <= 2; x++) {
            var blk = this.add
              .image(x * 100, y * 100, 'block' + x + y)
              .setOrigin(0, 0)
              .setInteractive();
            blk.name = 'block' + x + y;
            this.input.setDraggable(blk);
            blocks[y][x] = blk;
          }
        }
        this.input.on('drag', function(pointer, gameObject, dragX, dragY) {
          const downX = pointer.downX;
          const downY = pointer.downY;
          const blockName = gameObject.name;
          const xScale = (gameObject.x + dragX * 2.5) / width + 1;
          const yScale = (gameObject.y + dragY * 2.5) / height + 1;
          gameObject.setScale(xScale, yScale);

          const w = gameObject.width * xScale;
          const h = gameObject.height * yScale;
          const w2 = (width - w) / 2;
          const h2 = (height - h) / 2;

          const col = gameObject.name.substring(
            blockName.length - 2,
            blockName.length - 1,
          );
          const row = gameObject.name.substring(
            blockName.length - 1,
            blockName.length,
          );
          for (let y = 0; y <= 2; y++) {
            for (let x = 0; x <= 2; x++) {
              if (!(col == x && row == y)) {
                adjustRows(height, gameObject, h, row, x, y, h2, downY);
                adjustCols(width, gameObject, w, col, x, y, w2, downX);
              }
            }
          }
        });
      }

      function adjustCols(W, block, w, col, col2, row2, w2, downX) {
        var block2 = blocks[row2][col2];
        switch (col) {
          case '0':
            if (col2 > col) {
              var block3 = blocks[row2][col2 - 1];
              block2.scaleX = w2 / block2.width;
              block2.x = block3.scaleX * block3.width + block3.x;
            } else block2.scaleX = w / block2.width;
            break;
          case '1':
            if (downX > block.x + block.scaleX) {
              console.log('mouse right of block');
              block2.x = block.x + block.scaleX;
              block2.width = W - block.x + block.scaleX;
            } else {
              console.log('mouse left of block');
              block2.scaleX = w / block2.width;
            }
            break;
            if (col2 < col) {
              var block3 = blocks[row2][col2 + 1];
              block2.scaleX = w2 / block2.width;
              block2.x = block3.scaleX * block3.width - block3.x;
            } else {
              block2.x = block3.scaleX * block3.width - block3.x;
            }
            break;
          default:
            break;
        }
      }

      function adjustRows(H, block, h, row, col2, row2, h2, dragY) {
        var block2 = blocks[row2][col2];
        switch (row) {
          case '0':
            if (row2 > row) {
              var block3 = blocks[row2 - 1][col2];
              block2.scaleY = h2 / block2.height;
              block2.y = block3.scaleY * block3.height + block3.y;
            } else block2.scaleY = h / block2.height;
            break;
          case '1':
            if (dragY > block.y) {
              block2.y = block.y + block.height;
              block2.height = H - block.y + block.height;
            } else block2.height = block.y;
            break;
          case '2':
            if (row2 != row) {
              block2.height = h2;
              block2.y = blocks[row2 + 1][col2].width;
            } else {
              block2.height = block.height;
              block2.y = block.y;
            }
            break;
          default:
            break;
        }
      }
      function update() {}
    </script>
  </body>
</html>
